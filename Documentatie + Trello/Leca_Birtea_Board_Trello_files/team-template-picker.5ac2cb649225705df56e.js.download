(window.webpackJsonp=window.webpackJsonp||[]).push([[201],{"./app/src/components/TemplatePicker/TeamTemplatePicker.tsx":function(e,n,i){"use strict";i.r(n),i.d(n,"TeamTemplatePickerUnconnected",(function(){return A})),i.d(n,"TeamTemplatePicker",(function(){return C}));var a=i("./node_modules/react/index.js"),t=i.n(a),r=i("./node_modules/moment/moment.js"),s=i.n(r),d=i("./packages/session-cookie/index.ts"),m=i("./node_modules/js-cookie/src/js.cookie.js"),o=i.n(m),l=i("./packages/dates/index.ts"),c=i("./packages/atlassian-analytics/index.ts"),u=i("./packages/locale/index.ts"),p=i("./app/src/components/ComponentWrapper/index.ts"),k=i("./app/scripts/debug/constants.ts"),b=i("./packages/organizations/index.ts"),v=i("./packages/product-features/index.ts"),g=i("./packages/members/index.ts"),y=i("./node_modules/@apollo/client/index.js");function N(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),i.push.apply(i,a)}return i}function O(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?N(Object(i),!0).forEach((function(n){T(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):N(Object(i)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))}))}return e}function T(e,n,i){return n in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}const f={context:{operationName:"TeamTemplatePicker"}},S={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"TeamTemplatePicker"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"orgId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"member"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"StringValue",value:"me",block:!1}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"oneTimeMessagesDismissed"}},{kind:"Field",name:{kind:"Name",value:"idPremOrgsAdmin"}},{kind:"Field",name:{kind:"Name",value:"memberType"}},{kind:"Field",name:{kind:"Name",value:"idEnterprise"}},{kind:"Field",name:{kind:"Name",value:"enterpriseLicenses"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"idEnterprise"}},{kind:"Field",name:{kind:"Name",value:"type"}}]}},{kind:"Field",name:{kind:"Name",value:"confirmed"}},{kind:"Field",name:{kind:"Name",value:"organizations"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"idEnterprise"}},{kind:"Field",name:{kind:"Name",value:"products"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"organization"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"orgId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"idMemberCreator"}},{kind:"Field",name:{kind:"Name",value:"teamType"}},{kind:"Field",name:{kind:"Name",value:"products"}},{kind:"Field",name:{kind:"Name",value:"idEnterprise"}},{kind:"Field",name:{kind:"Name",value:"products"}},{kind:"Field",name:{kind:"Name",value:"boards"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"idBoardSource"}}]}},{kind:"Field",name:{kind:"Name",value:"prefs"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"boardVisibilityRestrict"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"private"}},{kind:"Field",name:{kind:"Name",value:"org"}},{kind:"Field",name:{kind:"Name",value:"enterprise"}},{kind:"Field",name:{kind:"Name",value:"public"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"memberships"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"idMember"}},{kind:"Field",name:{kind:"Name",value:"memberType"}}]}}]}}]}}]};function j(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),i.push.apply(i,a)}return i}function F(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?j(Object(i),!0).forEach((function(n){P(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):j(Object(i)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))}))}return e}function P(e,n,i){return n in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}const D={context:{operationName:"DismissTeamTemplatePicker"}},E={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DismissTeamTemplatePicker"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"memberId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"messageId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addOneTimeMessagesDismissed"},arguments:[{kind:"Argument",name:{kind:"Name",value:"memberId"},value:{kind:"Variable",name:{kind:"Name",value:"memberId"}}},{kind:"Argument",name:{kind:"Name",value:"messageId"},value:{kind:"Variable",name:{kind:"Name",value:"messageId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"oneTimeMessagesDismissed"}}]}}]}}]};var I=i("./packages/graphql/generated.tsx"),w=i("./app/src/components/TemplatePicker/TemplatePicker.tsx"),M=i("./packages/feature-flag-client/index.ts"),h=i("./app/src/components/TemplatePicker/types.ts"),x=i("./packages/error-reporting/index.ts");const V={[b.TeamTypes.Other]:h.a.Popular,[b.TeamTypes.SmallBusiness]:h.a.Business,[b.TeamTypes.Education]:h.a.Education,[b.TeamTypes.EngineeringIT]:h.a.Engineering,[b.TeamTypes.Marketing]:h.a.Marketing,[b.TeamTypes.HumanResources]:h.a.HumanResources,[b.TeamTypes.Operations]:h.a.Operations,[b.TeamTypes.SalesCRM]:h.a.SalesCRM},A=({orgId:e})=>{var n;const i=Object(M.useFeatureFlag)("teamplates.web.team-picker-template-list",{}),r=Object(u.languageParts)(u.currentLocale).language;let m;m=i[u.currentLocale]?i[u.currentLocale]:i[r]?i[r]:i.en;const[p,N]=Object(a.useState)(h.a.Popular),[T,j]=Object(a.useState)(!1),[P]=function(e){const n=F(F({},D),e);return y.useMutation(E,n)}(),{data:A,loading:C}=function(e){const n=O(O({},f),e);return y.useQuery(S,n)}({variables:{orgId:e},skip:!d.memberId}),_="team-template-picker-".concat(e),z=null==A?void 0:A.member,B=null==A?void 0:A.organization,R=(null==z?void 0:z.oneTimeMessagesDismissed)||[],L=null==B?void 0:B.idMemberCreator,U=(null==B?void 0:B.name)||"",Y=(null==B?void 0:B.boards)||[],q=!!z&&!!B&&Object(b.isMemberAdmin)(z,B);let H=null==A||null===(n=A.organization)||void 0===n?void 0:n.teamType;H||(H=b.TeamTypes.Other);let J=!!z&&!!B&&Object(b.canSetVisibilityOnBoard)({org:B,boardVisibility:I.b.Org,isOrgAdmin:q});B&&B.idEnterprise&&(J=Object(b.canSetVisibilityOnBoard)({org:B,boardVisibility:I.b.Enterprise,isOrgAdmin:q})),z&&z.idEnterprise&&(J=!!z&&(!Object(g.isPaidManagedEnterpriseMember)(z)||v.ProductFeatures.isEnterpriseProduct(null==B?void 0:B.products[0])));let W=!1;if(!C){const n=s()("2020-03-04","YYYY-MM-DD");W=s()(Object(l.f)(e)).isBefore(n)||!!o.a.get("team-template-picker.simulateExistingOrg")||L===d.memberId}const Q=Object(u.usesLanguages)(Object.keys(i))&&W&&J&&!R.includes(_)&&!C;if(Object(a.useEffect)((()=>{Q&&c.Analytics.sendViewedComponentEvent({componentType:"section",componentName:"teamTemplatePickerSection",source:Object(c.getScreenFromUrl)({orgName:U}),containers:{organization:{id:e}},attributes:{teamType:H}})}),[e,H,Q,U]),Object(a.useEffect)((()=>{const e=V[H];e&&N(e)}),[H]),!Q)return null;if(Y.length>3)return T||(j(!0),P({variables:{memberId:"me",messageId:_},optimisticResponse:{__typename:"Mutation",addOneTimeMessagesDismissed:{id:"me",oneTimeMessagesDismissed:R.concat([_]),__typename:"Member"}}})),null;const G=Y.map((({idBoardSource:e})=>e)),K=m[p].filter((e=>!G.includes(e)));if(!K.length)return null;return t.a.createElement(w.a,{templateIds:K,onDismiss:async()=>{c.Analytics.sendDismissedComponentEvent({componentType:"section",componentName:"teamTemplatePickerSection",source:Object(c.getScreenFromUrl)({orgName:U}),containers:{organization:{id:e}},attributes:{teamType:H}});try{await P({variables:{memberId:"me",messageId:_},optimisticResponse:{__typename:"Mutation",addOneTimeMessagesDismissed:{id:"me",oneTimeMessagesDismissed:R.concat([_]),__typename:"Member"}}})}catch(e){Object(x.sendErrorEvent)(e,{tags:{ownershipArea:"trello-teamplates",feature:k.Feature.TeamTemplatePicker}})}},onTemplateClicked:n=>(c.Analytics.sendUIEvent({action:"clicked",actionSubject:"sectionItem",actionSubjectId:"templateTileSectionItem",source:"teamTemplatePickerSection",containers:{organization:{id:e},board:{id:n}}}),!0),onChangeCategory:({value:n})=>{c.Analytics.sendUIEvent({action:"clicked",actionSubject:"dropdownItem",actionSubjectId:"templatePickerCategoryDropdownItem",source:"templatePickerSection",attributes:{category:n,organization:{id:e}}}),N(n)},selectedCategory:p})},C=e=>t.a.createElement(p.ComponentWrapper,null,t.a.createElement(A,e))}}]);
//# sourceMappingURL=team-template-picker.5ac2cb649225705df56e.js.map